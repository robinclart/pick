#!/usr/bin/env ruby

require "bundler/setup"
require "irb"
require "pick"
require "json"
require "pp"

argv           = ARGV.clone
irb            = argv.shift.strip == "1"
aliases        = Hash[argv.shift.split(",").map { |a| a.split(":", 2) }]
tokens         = Pick.lex(argv)
tree           = Pick.parse(tokens, aliases: aliases)
interpretation = Pick.interpret(tree)
$command       = Pick::Command.new(**interpretation)

puts
puts "-- aliases"
p aliases
puts
puts "-- argv"
p argv
puts
puts "-- tokens"
p tokens
puts
puts "-- tree"
pp tree
puts
puts "-- interpretation"
p interpretation
puts

if irb
  ARGV.clear
  IRB.start
end
